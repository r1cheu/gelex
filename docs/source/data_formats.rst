Data Formats
============

Gelex supports standard bioinformatics formats for genomic analysis. Most files are either standard PLINK binary formats or tab-separated values (TSV).

Input Data Formats
------------------

.. _genotype-format:

Genotype Data (PLINK Binary)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Gelex uses the PLINK 1.x binary format (**BED**/**BIM**/**FAM**) as its primary genotype input (see `PLINK 1.9 formats <https://www.cog-genomics.org/plink/1.9/formats#bed>`_).

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - Extension
     - Description
   * - **.bed**
     - Binary file containing the genotypes.
   * - **.bim**
     - Text file containing SNP information (chromosome, ID, position, alleles).
   * - **.fam**
     - Text file containing individual information (FID, IID, parents, sex, phenotype).

.. important::
   When specifying a genotype file via ``--bfile``, provide the **prefix only**. Gelex will automatically look for files ending in ``.bed``, ``.bim``, and ``.fam``.

Example:
   ``--bfile mydata`` will load ``mydata.bed``, ``mydata.bim``, and ``mydata.fam``.

.. _phenotype-format:

Phenotype Data
~~~~~~~~~~~~~~

Phenotype files should be tab-separated (TSV) or space-separated text files with a required header row.

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - Component
     - Requirement
   * - **Format**
     - ``FID IID Trait1 Trait2 ...``
   * - **Header**
     - A header row is required.
   * - **Missing values**
     - Use ``-9``, ``NA``, or ``nan``.

.. tip::
   By default, Gelex reads the **3rd column** (index 2) as the trait. Use ``--pheno-col`` to specify a different column (1-based or by name).

Example:

.. code-block:: text

   FID    IID    Height    Weight
   1001   1001   175.5     70.2
   1002   1002   168.0     -9
   1003   1003   NA        65.5

.. _covariate-format:

Covariate Data
~~~~~~~~~~~~~~

Gelex supports two types of covariates. Both follow the same basic structure as the phenotype file (FID, IID, followed by data).

Quantitative Covariates (qcovar)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Used for continuous variables like age, BMI, or Principal Components (PCs). Use ``--qcovar`` to load.

.. code-block:: text

   FID    IID    Age    PC1       PC2
   1001   1001   45     -0.012    0.045
   1002   1002   32     0.005     -0.021

Discrete Covariates (dcovar)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Used for categorical variables like sex, batch, or site. Gelex internally converts these into dummy variables (one-hot encoding). Use ``--dcovar`` to load.

.. code-block:: text

   FID    IID    Sex    Site
   1001   1001   1      A
   1002   1002   2      B
   1003   1003   1      B

.. _grm-format:

Genomic Relationship Matrix (GRM)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Gelex uses GRM files in the **GCTA binary format**.

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - Extension
     - Description
   * - **.grm.bin**
     - Binary file containing the lower triangle of the relationship matrix.
   * - **.grm.id**
     - Text file containing the FID and IID of individuals in the matrix.


.. note::
   When using ``--grm``, you can provide either the prefix (e.g., ``my_grm``) or the full path to the binary file.

Output Data Formats
-------------------

Gelex generates structured output files based on the command executed.

.. _snp-eff-format:

SNP Effects (.snp.eff)
~~~~~~~~~~~~~~~~~~~~~~

Generated by the ``fit`` command. Contains posterior estimates for each SNP.

.. list-table::
   :header-rows: 1
   :widths: 25 75

   * - Column
     - Description
   * - ``Index``
     - 1-based SNP index
   * - ``ID``
     - SNP identifier
   * - ``Chrom``
     - Chromosome name
   * - ``Position``
     - Base-pair position
   * - ``A1, A2``
     - Effect allele and reference allele
   * - ``A1Freq``
     - Frequency of the A1 allele
   * - ``Add, AddSE``
     - Posterior mean and standard deviation of the additive effect
   * - ``AddPVE``
     - Proportion of variance explained by the additive effect
   * - ``PIP``
     - Posterior Inclusion Probability (for mixture models)
   * - ``Dom, DomSE``
     - (Optional) Dominance effect posterior mean and standard deviation
   * - ``DomPVE, PIP``
     - (Optional) Dominance-specific PVE and PIP
   * - ``pi_k``
     - (Optional) Posterior probability for the k-th mixture component

.. _param-format:

Model Parameters (.param)
~~~~~~~~~~~~~~~~~~~~~~~~~

Generated by the ``fit`` command. Summarizes model-wide parameters.

.. list-table::
   :header-rows: 1
   :widths: 25 75

   * - Column
     - Description
   * - ``term``
     - Parameter name (e.g., ``σ²_add``, ``h²``, ``Intercept``)
   * - ``mean``
     - Posterior mean
   * - ``stddev``
     - Posterior standard deviation
   * - ``5%, 95%``
     - 90% Credible Interval boundaries
   * - ``ess``
     - Effective Sample Size
   * - ``rhat``
     - Potential Scale Reduction Factor (Gelman-Rubin diagnostic)

.. _gwas-output-format:

GWAS Results (.gwas.tsv)
~~~~~~~~~~~~~~~~~~~~~~~~

Generated by the ``assoc`` command. Standard summary statistics for association testing.

.. list-table::
   :header-rows: 1
   :widths: 25 75

   * - Column
     - Description
   * - ``CHR, SNP, BP``
     - Chromosome, ID, and base-pair position
   * - ``A1, A2``
     - Effect allele and other allele
   * - ``A1FREQ``
     - Effect allele frequency
   * - ``BETA``
     - Effect size estimate (Wald test)
   * - ``SE``
     - Standard error of the effect size
   * - ``P``
     - P-value from the Wald test

.. _predict-output-format:

Prediction Results (.pred.tsv)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Generated by the ``predict`` command. Contains individual genetic risk scores.

.. list-table::
   :header-rows: 1
   :widths: 25 75

   * - Column
     - Description
   * - ``FID, IID``
     - Individual identifiers (FID omitted if ``--iid-only``)
   * - ``prediction``
     - Total predicted value (Additive + Dominance + Covariates)
   * - ``{covar}``
     - Estimated contribution of each covariate
   * - ``additive``
     - Predicted additive genetic value (Estimated Breeding Value)
   * - ``dominant``
     - (Optional) Predicted dominance genetic value
